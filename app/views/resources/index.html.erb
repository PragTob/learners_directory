<h2>Welcome to the RailsApps Learners Directory</h2>
<h4>Here you will find resources to learn Ruby on Rails</h4>
  <br>
  <tbody>
    <% @sorted_desc_resources.each do |resource| %>
      <div class="resource-box">
        <div class="text-section">
          <h4><%= link_to "#{resource.title}", resource_path(resource.id) %></h4>
          <p><a href="<%= resource.link %>" target="_blank"><%= resource.link %></a></p>
          <p><%= resource.summary %></p>
          
          <p>Posted at <%= resource.created_at %></p>
          
          <p>Average Rating:
              <% if resource.average_rating == 0 %>
                <%= "This resource has not been rated yet" %>
              <% else %>
                <%= resource.average_rating %>
              <% end %></p>
                 
          <p>Posted by: <%= link_to "#{resource.user.name}", user_path(resource.user) %></p>
          
          <% if resource.comments.count == 1 %>
            <p>This resource has <%= link_to "#{resource.comments.count} comment", resource_path(resource.id) %></p>
          <% else %>
            <p>This resource has <%= link_to "#{resource.comments.count} comments", resource_path(resource.id) %></p>
          <% end %>

          <p>Number of tags: <%=resource.tags.count %></p>

          <p>Tags: <% resource.tags.each do |tag| %>
            <%= link_to tag.name, resources_path(:tag => tag.name) %>
          <% end %></p>
          
          <% if correct_user?(resource) %>
            <p><%= link_to "Delete resource", resource_path(resource), :method => :delete, :class => 'action' %></p>
            <p><%= link_to "Edit resource", edit_resource_path(resource) %></p>
          <% end %>

        </div>

        <div class="rating-section">
          <div >
             <button type="button" class="btn btn-info btn-mini rating-button">Rate Resource <i class="icon-star"></i></button>
          </div>
        <% if current_user %>
          <div class="rating-box">
            <br>
            <p>Your rating: <%= current_user_rating(resource.id) %></p>

            <%= form_for (rating_ballot(resource.id)) do |f| %>
            
              <%= f.radio_button(:value, 1) %>
              <%= f.label(:value_rating, "1") %>
              <%= f.radio_button(:value, 2) %>
              <%= f.label(:value_rating, "2") %>
              <%= f.radio_button(:value, 3) %>
              <%= f.label(:value_rating, "3") %>
              <%= f.radio_button(:value, 4) %>
              <%= f.label(:value_rating, "4") %>
              <%= f.radio_button(:value, 5) %>
              <%= f.label(:value_rating, "5") %>

              <%= f.hidden_field(:resource_id) %>
              <%= f.hidden_field(:user_id) %>
              <%= f.submit %>

            <% end %>
          </div>

        <% else %>
          <br>
          <p>In order to rate a resource please sign up with your Github account</p>
        <% end %> 
        </div>
          <br style="clear:both;"/>
    </div>
    <br>
    <% end %>
  </tbody>

<br>

<%= link_to 'Post a Resource', new_resource_path %>
        

